<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üí∞ Qu·∫£n L√Ω Chi Ti√™u N√¢ng C·∫•p iOS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ====================================
           I. BI·∫æN CSS V√Ä RESET CHU·∫®N IOS
           ==================================== */
        :root {
            --ios-blue: #007AFF;
            --ios-blue-active: #005ac9;
            --ios-red: #FF3B30;
            --ios-green: #34C759;
            --ios-orange: #FF9500;
            --ios-background: #F5F5F7;
            --ios-card-bg: rgba(255, 255, 255, 0.78);
            --ios-text-primary: #1C1C1E;
            --ios-text-secondary: #8E8E93;
            --ios-separator: rgba(60, 60, 67, 0.16);
            --breathing-space: 20px;
            --card-border-radius: 18px;
            --input-border-radius: 12px;
            --button-border-radius: 14px;
            --bottom-bar-height: 80px;
            --ios-easing: cubic-bezier(0.25, 0.1, 0.25, 1);
            --ios-shadow-soft: 0 6px 20px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 0; margin: 0;
            background: var(--ios-background);
            color: var(--ios-text-primary);
            padding-bottom: calc(var(--bottom-bar-height) + env(safe-area-inset-bottom, 20px));
            line-height: 1.4;
        }

        .container {
            padding: 0 var(--breathing-space);
            max-width: 430px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            padding: 60px var(--breathing-space) 20px;
            background: var(--ios-background);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        h1 { font-size: 26px; font-weight: 700; margin: 0; letter-spacing: -0.5px; }

        /* BOX */
        .box {
            background: var(--ios-card-bg);
            backdrop-filter: blur(15px) saturate(180%);
            -webkit-backdrop-filter: blur(15px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: var(--breathing-space);
            border-radius: var(--card-border-radius);
            margin-top: var(--breathing-space);
            box-shadow: var(--ios-shadow-soft);
            overflow: hidden;
            transition: all 0.3s var(--ios-easing);
        }

        /* COLLAPSIBLE LOGIC */
        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .box-header h2 { margin: 0; font-size: 20px; font-weight: 600; }
        .box-header::after {
            content: "‚ñæ";
            font-size: 20px;
            color: var(--ios-text-secondary);
            transition: transform 0.3s;
        }
        .box.collapsed .box-header::after { transform: rotate(-90deg); }
        .box.collapsed .box-content { display: none; }
        
        /* Ph·∫ßn Lu√¥n Hi·ªán */
        .box.always-show .box-header { cursor: default; }
        .box.always-show .box-header::after { display: none; }

        /* INPUTS */
        input[type="text"], input[type="number"], input[type="date"], select {
            padding: 14px 15px;
            border-radius: var(--input-border-radius);
            border: 1px solid var(--ios-separator);
            margin-top: 10px;
            width: 100%;
            font-size: 16px;
            background: #FFFFFF;
            transition: all 0.3s var(--ios-easing);
            -webkit-appearance: none;
        }

        input:focus, select:focus {
            border-color: var(--ios-blue);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.2);
        }

        /* BUTTONS */
        button {
            padding: 15px;
            border-radius: var(--button-border-radius);
            border: none;
            margin-top: 15px;
            width: 100%;
            font-size: 17px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            background: var(--ios-blue);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
            transition: all 0.2s var(--ios-easing);
            -webkit-tap-highlight-color: transparent;
        }

        button:active { transform: scale(0.97); opacity: 0.9; }

        .secondary-btn {
            background: #8E8E93;
            box-shadow: 0 4px 12px rgba(142, 142, 147, 0.3);
            margin-top: 10px;
        }

        /* POPUP CH·ªåN NGU·ªíN TI·ªÄN */
        .overlay-sheet {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .overlay-sheet.active { opacity: 1; }
        .action-sheet {
            background: #F2F2F7;
            width: 90%;
            max-width: 340px;
            border-radius: 20px;
            padding: 20px;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .overlay-sheet.active .action-sheet { transform: scale(1); }
        .sheet-title { text-align: center; font-size: 17px; color: var(--ios-text-primary); padding-bottom: 15px; font-weight: 600; }
        .sheet-group { background: white; border-radius: 14px; overflow: hidden; margin-bottom: 15px; border: 0.5px solid var(--ios-separator); }
        .sheet-item { width: 100%; background: white; color: var(--ios-blue); padding: 16px; font-size: 17px; border: none; border-bottom: 0.5px solid var(--ios-separator); display: flex; flex-direction: column; align-items: center; }
        .sheet-item:active { background: #F2F2F7; }
        .sheet-cancel { background: white; color: var(--ios-blue); font-weight: 500; border-radius: 14px; margin-top: 0; height: 50px; border: 0.5px solid var(--ios-separator); }

        /* C√ÅC PH·∫¶N HI·ªÇN TH·ªä CHI TI·∫æT */
        #categoryList span {
            display: inline-block;
            background: rgba(0, 122, 255, 0.1);
            color: var(--ios-blue);
            padding: 6px 12px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .summary-item, .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 0.5px solid var(--ios-separator);
        }

        .income-value { color: var(--ios-green); font-weight: 600; }
        .expense-value { color: var(--ios-red); font-weight: 600; }
        .remain-value { font-weight: 700; color: var(--ios-blue); }

        .delete-btn {
            padding: 8px 12px;
            margin-top: 0;
            width: auto;
            background: var(--ios-red);
            font-size: 12px;
            border-radius: 8px;
        }

        /* IFRAME OVERLAY */
        #soduOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        #soduOverlay iframe { flex-grow: 1; border: none; width: 100%; height: 100%; }
        .back-btn-container {
            padding: calc(env(safe-area-inset-top, 20px) + 10px) 20px 10px;
            background: var(--ios-background);
            border-bottom: 0.5px solid var(--ios-separator);
            display: flex;
            align-items: center;
        }
        .back-btn { background: none; color: var(--ios-blue); box-shadow: none; padding: 0; margin: 0; width: auto; font-size: 17px; display: flex; align-items: center; }
        .back-btn::before { content: "„Äà"; margin-right: 5px; font-weight: bold; }

        /* TAB BAR */
        .bottom-tab-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: var(--bottom-bar-height);
            background: var(--ios-card-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 0.5px solid var(--ios-separator);
            display: flex;
            justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            z-index: 200;
        }
        .tab-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-decoration: none; color: var(--ios-text-secondary); font-size: 10px;
        }
        .tab-item.active { color: var(--ios-blue); }
        .tab-icon { font-size: 24px; }

        /* Toast */
        .ios-toast {
            position: fixed;
            top: 60px; left: 50%;
            transform: translate(-50%, -150%);
            background: rgba(45, 45, 45, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            z-index: 300;
            transition: all 0.5s var(--ios-easing);
            opacity: 0;
        }
        .ios-toast.show { transform: translate(-50%, 0); opacity: 1; }

        .date-range-group { display: flex; align-items: center; gap: 10px; }
        #filterExpenseBtn { background: var(--ios-orange); box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3); }
    </style>
</head>
<body>

<div id="paymentOverlay" class="overlay-sheet" onclick="closePaymentSheet()">
    <div class="action-sheet" id="paymentSheet" onclick="event.stopPropagation()">
        <div class="sheet-title">Ch·ªçn t√†i kho·∫£n thanh to√°n</div>
        <div class="sheet-group" id="accountButtonsList"></div>
        <button class="sheet-cancel" onclick="closePaymentSheet()">H·ªßy b·ªè</button>
    </div>
</div>

<div id="soduOverlay">
    <div class="back-btn-container">
        <button class="back-btn" onclick="closeSodu()">Quay l·∫°i</button>
    </div>
    <iframe id="soduFrame" src=""></iframe>
</div>

<div class="header">
    <h1>üí∞ Qu·∫£n L√Ω Chi Ti√™u</h1>
</div>

<div class="container">
    
    <div class="box always-show">
        <div class="box-header">
            <h2>üìù Ghi chi ti√™u</h2>
        </div>
        <div class="box-content" style="margin-top:15px">
            <label style="font-size: 14px; color: var(--ios-text-secondary);">H·∫°ng m·ª•c:</label>
            <select id="selectCategory"></select>
            <input type="text" id="expenseAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn ƒë√£ chi...">
            <button id="addExpense">Ghi Chi Ti√™u & Tr·ª´ Ti·ªÅn</button>
        </div>
    </div>

    <div class="box always-show summary">
        <div class="box-header">
            <h2>üìà T·ªïng quan</h2>
        </div>
        <div class="box-content">
            <div class="summary-item" id="showIncome">Doanh thu: <strong class="income-value">0 ƒë</strong></div>
            <div class="summary-item" id="showTotalSpent">T·ªïng chi: <strong class="expense-value">0 ƒë</strong></div>
            <div class="summary-item" id="showRemain">C√≤n l·∫°i: <strong class="remain-value">0 ƒë</strong></div>
            <div class="summary-item" id="showTodaySpent">Chi h√¥m nay: <strong style="color:var(--ios-orange)">0 ƒë</strong></div>
        </div>
    </div>

    <div class="box collapsed">
        <div class="box-header" onclick="toggleBox(this)">
            <h2>üíµ Doanh thu th√°ng</h2>
        </div>
        <div class="box-content" style="margin-top:10px">
            <input type="text" id="monthlyIncome" placeholder="Nh·∫≠p s·ªë ti·ªÅn doanh thu th√°ng...">
            <input type="date" id="incomeDateInput">
            <button id="saveIncome">L∆∞u Doanh Thu</button>
            <div class="summary-item" id="showIncomeDate" style="border-bottom:none">Ng√†y ghi: <strong style="color:var(--ios-text-secondary);">N/A</strong></div>
            <button class="secondary-btn" onclick="openSodu()">üí≥ Qu·∫£n l√Ω s·ªë d∆∞</button>
        </div>
    </div>

    <div class="box collapsed">
        <div class="box-header" onclick="toggleBox(this)">
            <h2>‚ûï Th√™m h·∫°ng m·ª•c</h2>
        </div>
        <div class="box-content" style="margin-top:10px">
            <input type="text" id="categoryInput" placeholder="ƒÇn u·ªëng, XƒÉng, Cafe...">
            <button id="addCategory">Th√™m H·∫°ng M·ª•c</button>
            <div id="categoryList" style="margin-top:15px"></div>
        </div>
    </div>
    
    <div class="box collapsed">
        <div class="box-header" onclick="toggleBox(this)">
            <h2>üè∑Ô∏è Chi theo kho·∫£n</h2>
        </div>
        <div class="box-content">
            <div id="categorySummary"></div>
        </div>
    </div>
    
    <div class="box collapsed">
        <div class="box-header" onclick="toggleBox(this)">
            <h2>üîé L·ªçc chi ti√™u</h2>
        </div>
        <div class="box-content" style="margin-top:10px">
            <div class="date-range-group">
                 <input type="date" id="startDateInput">
                 <span>ƒë·∫øn</span>
                 <input type="date" id="endDateInput">
            </div>
            <button id="filterExpenseBtn">L·ªçc Theo Kho·∫£ng Ng√†y</button>
            <div class="summary-item" style="margin-top: 15px;">
                 T·ªïng l·ªçc: <strong class="expense-value" id="filteredTotalAmount">0 ƒë</strong>
            </div>
            <div id="dailyCategorySummaryBox" style="display: none; border-top: 1px solid var(--ios-separator); margin-top: 10px; padding-top: 10px;">
                 <h3 style="font-size: 16px;">Chi ti·∫øt:</h3>
                 <div id="dailyCategorySummary"></div>
            </div>
        </div>
    </div>

    <div class="box collapsed">
        <div class="box-header" onclick="toggleBox(this)">
            <h2>‚è≥ L·ªãch s·ª≠ (<span id="historyTitle">To√†n b·ªô</span>)</h2>
        </div>
        <div class="box-content">
            <div id="expenseHistory"></div>
        </div>
    </div>
</div>

<div class="bottom-tab-bar">
    <a href="#" class="tab-item active"><span class="tab-icon">üìä</span><span>T·ªïng quan</span></a>
    <a href="#" class="tab-item"><span class="tab-icon">‚ûï</span><span>Ghi chi</span></a>
    <a href="#" class="tab-item"><span class="tab-icon">‚öôÔ∏è</span><span>C√†i ƒë·∫∑t</span></a>
</div>

<div class="ios-toast" id="iosToast">Th√†nh c√¥ng!</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4k2DyiEVKXcMpc_j9XwqZG1OHHBNegDk",
  authDomain: "lichnghi-4c665.firebaseapp.com",
  databaseURL: "https://lichnghi-4c665-default-rtdb.firebaseio.com",
  projectId: "lichnghi-4c665",
  storageBucket: "lichnghi-4c665.firebasestorage.app",
  messagingSenderId: "86673813509",
  appId: "1:86673813509:web:168376408dfcbf14e16c6c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth();
signInAnonymously(auth);

// --- C√†i ƒë·∫∑t ƒë√≥ng m·ªü c√°c h·ªôp ---
window.toggleBox = (header) => {
    header.parentElement.classList.toggle('collapsed');
};

const monthlyIncomeInput = document.getElementById("monthlyIncome");
const incomeDateInput = document.getElementById("incomeDateInput");
const saveIncomeBtn = document.getElementById("saveIncome");
const categoryInput = document.getElementById("categoryInput");
const addCategoryBtn = document.getElementById("addCategory");
const categoryList = document.getElementById("categoryList");
const categorySelect = document.getElementById("selectCategory");
const expenseAmountInput = document.getElementById("expenseAmount");
const addExpenseBtn = document.getElementById("addExpense");
const showIncome = document.getElementById("showIncome");
const showIncomeDate = document.getElementById("showIncomeDate");
const showTotalSpent = document.getElementById("showTotalSpent");
const showRemain = document.getElementById("showRemain");
const showTodaySpent = document.getElementById("showTodaySpent");
const categorySummaryDiv = document.getElementById("categorySummary");
const expenseHistoryDiv = document.getElementById("expenseHistory");
const iosToast = document.getElementById("iosToast");
const startDateInput = document.getElementById("startDateInput");
const endDateInput = document.getElementById("endDateInput");
const filterExpenseBtn = document.getElementById("filterExpenseBtn");
const historyTitle = document.getElementById("historyTitle");
const filteredTotalAmount = document.getElementById("filteredTotalAmount");
const dailyCategorySummaryBox = document.getElementById("dailyCategorySummaryBox"); 
const dailyCategorySummaryDiv = document.getElementById("dailyCategorySummary"); 

let allExpenses = {};
let currentAccounts = {};

const formatCurrency = (n) => Number(n).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }).replace('‚Ç´', ' ƒë');
const formatDate = (s) => s ? new Date(s).toLocaleDateString('vi-VN') : 'N/A';
const getNumericValue = (el) => Number(el.value.replace(/[^0-9]/g, ''));
const formatInput = (el) => {
    let v = el.value.replace(/[^0-9]/g, '');
    if (v) el.value = new Intl.NumberFormat('vi-VN').format(Number(v));
};

const showToast = (m) => {
    iosToast.textContent = m;
    iosToast.classList.add('show');
    setTimeout(() => iosToast.classList.remove('show'), 2000);
};

window.openPaymentSheet = function() {
    const amt = getNumericValue(expenseAmountInput);
    if (!amt || amt <= 0) return alert("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn!");
    const overlay = document.getElementById('paymentOverlay');
    overlay.style.display = 'flex';
    setTimeout(() => overlay.classList.add('active'), 10);
};

window.closePaymentSheet = function() {
    const overlay = document.getElementById('paymentOverlay');
    overlay.classList.remove('active');
    setTimeout(() => overlay.style.display = 'none', 300);
};

// --- FIREBASE LOGIC ---
onValue(ref(db, "khoantien"), (snapshot) => {
    const accountListDiv = document.getElementById("accountButtonsList");
    accountListDiv.innerHTML = "";
    currentAccounts = {};
    if (snapshot.exists()) {
        const data = snapshot.val();
        Object.keys(data).forEach(key => {
            const item = data[key];
            const tenLower = item.ten.toLowerCase();
            if (tenLower.includes("ti·ªÅn m·∫∑t") || tenLower.includes("t√†i kho·∫£n")) {
                currentAccounts[key] = item;
                const btn = document.createElement("button");
                btn.className = "sheet-item";
                btn.innerHTML = `<strong>${item.ten}</strong><span style="font-size:12px; opacity:0.7;">S·ªë d∆∞: ${formatCurrency(item.sotien)}</span>`;
                btn.onclick = () => executeTransaction(key);
                accountListDiv.appendChild(btn);
            }
        });
    }
});

async function executeTransaction(selectedKey) {
    const amt = getNumericValue(expenseAmountInput);
    const category = categorySelect.value;
    const account = currentAccounts[selectedKey];
    closePaymentSheet();
    try {
        const accountRef = ref(db, `khoantien/${selectedKey}`);
        const newBalance = Number(account.sotien) - amt;
        await update(accountRef, { sotien: newBalance });
        await push(ref(db, "expenses"), {
            category: category,
            amount: amt,
            accountName: account.ten,
            date: new Date().toISOString().split("T")[0]
        });
        expenseAmountInput.value = "";
        showToast(`ƒê√£ tr·ª´ t·ª´ ${account.ten}`);
    } catch (e) { alert("L·ªói k·∫øt n·ªëi Firebase!"); }
}

addExpenseBtn.onclick = openPaymentSheet;

window.openSodu = function() {
    document.getElementById('soduFrame').src = 'sodu.html';
    document.getElementById('soduOverlay').style.display = 'flex';
    document.body.style.overflow = 'hidden';
};

window.closeSodu = function() {
    document.getElementById('soduOverlay').style.display = 'none';
    document.getElementById('soduFrame').src = '';
    document.body.style.overflow = 'auto';
};

saveIncomeBtn.onclick = () => {
    const val = getNumericValue(monthlyIncomeInput);
    if (val && incomeDateInput.value) {
        set(ref(db, "budget/monthlyIncome"), { amount: val, date: incomeDateInput.value })
        .then(() => showToast("ƒê√£ l∆∞u doanh thu"));
    }
};

addCategoryBtn.onclick = () => {
    const cat = categoryInput.value.trim();
    if (cat) {
        set(ref(db, "budget/categories/" + cat), true).then(() => {
            categoryInput.value = "";
            showToast("ƒê√£ th√™m h·∫°ng m·ª•c");
        });
    }
};

window.deleteExpense = (key) => {
    if (confirm("X√≥a l·ªãch s·ª≠ kho·∫£n n√†y?")) remove(ref(db, "expenses/" + key));
};

onValue(ref(db, "budget/categories"), snap => {
    categorySelect.innerHTML = ""; categoryList.innerHTML = "";
    if (snap.exists()) {
        Object.keys(snap.val()).forEach(c => {
            categorySelect.innerHTML += `<option value="${c}">${c}</option>`;
            categoryList.innerHTML += `<span>${c}</span>`;
        });
    }
});

const renderHistory = (data, start, end) => {
    expenseHistoryDiv.innerHTML = "";
    const items = Object.keys(data).map(k => ({k, ...data[k]})).sort((a,b) => new Date(b.date) - new Date(a.date));
    if (items.length === 0) { expenseHistoryDiv.innerHTML = "<p style='text-align:center;color:#888'>Tr·ªëng</p>"; return; }
    items.forEach(i => {
        expenseHistoryDiv.innerHTML += `
            <div class="expense-item">
                <div style="display:flex; flex-direction:column">
                    <span style="font-weight:500">${i.category}</span>
                    <span style="font-size:11px; color:#888">${formatDate(i.date)} ‚Ä¢ ${i.accountName || ''}</span>
                </div>
                <div style="display:flex; align-items:center gap:10px">
                    <span class="expense-value" style="margin-right:10px">${formatCurrency(i.amount)}</span>
                    <button class="delete-btn" onclick="deleteExpense('${i.k}')">X√≥a</button>
                </div>
            </div>`;
    });
};

const filterExpenses = (startStr, endStr) => {
    const s = new Date(startStr); const e = new Date(endStr);
    let filtered = {}; let total = 0; let cats = {};
    Object.keys(allExpenses).forEach(k => {
        const item = allExpenses[k]; const d = new Date(item.date);
        if (d >= s && d <= e) { filtered[k] = item; total += item.amount; cats[item.category] = (cats[item.category] || 0) + item.amount; }
    });
    filteredTotalAmount.textContent = formatCurrency(total);
    dailyCategorySummaryDiv.innerHTML = "";
    if (total > 0) {
        dailyCategorySummaryBox.style.display = 'block';
        Object.keys(cats).forEach(c => { dailyCategorySummaryDiv.innerHTML += `<div class="summary-item"><span>${c}</span><strong>${formatCurrency(cats[c])}</strong></div>`; });
    } else dailyCategorySummaryBox.style.display = 'none';
    renderHistory(filtered, startStr, endStr);
};

onValue(ref(db, "/"), snap => {
    const data = snap.val() || {};
    allExpenses = data.expenses || {};
    const income = data.budget?.monthlyIncome?.amount || 0;
    const incDate = data.budget?.monthlyIncome?.date || "";
    let total = 0; let todaySum = 0; let cats = {};
    const today = new Date().toISOString().split("T")[0];
    Object.values(allExpenses).forEach(e => {
        total += e.amount;
        if(e.date === today) todaySum += e.amount;
        cats[e.category] = (cats[e.category] || 0) + e.amount;
    });
    showIncome.innerHTML = `Doanh thu: <strong class="income-value">${formatCurrency(income)}</strong>`;
    showIncomeDate.innerHTML = `Ng√†y ghi: <strong style="color:#888">${formatDate(incDate)}</strong>`;
    showTotalSpent.innerHTML = `T·ªïng chi: <strong class="expense-value">${formatCurrency(total)}</strong>`;
    showRemain.innerHTML = `C√≤n l·∫°i: <strong class="remain-value">${formatCurrency(income - total)}</strong>`;
    showTodaySpent.innerHTML = `Chi h√¥m nay: <strong style="color:var(--ios-orange)">${formatCurrency(todaySum)}</strong>`;
    categorySummaryDiv.innerHTML = "";
    Object.keys(cats).forEach(c => { categorySummaryDiv.innerHTML += `<div class="summary-item"><span>${c}</span><strong class="expense-value">${formatCurrency(cats[c])}</strong></div>`; });
    filterExpenses(startDateInput.value || today, endDateInput.value || today);
});

filterExpenseBtn.onclick = () => filterExpenses(startDateInput.value, endDateInput.value);
monthlyIncomeInput.oninput = () => formatInput(monthlyIncomeInput);
expenseAmountInput.oninput = () => formatInput(expenseAmountInput);
window.onload = () => {
    const t = new Date().toISOString().split("T")[0];
    startDateInput.value = t; endDateInput.value = t; incomeDateInput.value = t;
};
</script>
</body>
</html>
